#:include src/widgets/base_screen.kv
#:import dp kivy.metrics.dp

<FooterButton@ButtonBehavior+BoxLayout>:
    orientation: "vertical"
    spacing: dp(4)
    padding: 0, dp(2), 0, 0
    size_hint: 1, None
    height: dp(64)
    background_color: 0, 0, 0, 0
    canvas.before:
        Color:
            rgba: self.background_color
        Rectangle:
            pos: self.pos
            size: self.size

<FooterLogoButton@ButtonBehavior+AnchorLayout>:
    anchor_x: "center"
    anchor_y: "center"
    background_color: 0, 0, 0, 0
    canvas.before:
        Color:
            rgba: self.background_color
        Rectangle:
            pos: self.pos
            size: self.size

<FaqScreen>:
    BaseScreen:
        # Top bar
        BoxLayout:
            id: top_bar
            size_hint_x: 1
            size_hint_y: None
            height: dp(68)
            pos_hint: {"x": 0, "top": 1}
            padding: dp(12), dp(8)
            spacing: dp(12)
            # Back button
            AnchorLayout:
                anchor_x: 'left'
                anchor_y: 'center'
                size_hint_x: None
                width: dp(48)
                MDIconButton:
                    icon: 'chevron-left'
                    theme_text_color: 'Custom'
                    text_color: 0,0,0,1
                    size_hint: None, None
                    size: dp(48), dp(48)
                    on_release: app.go_back()
            # Title placeholder (center)
            AnchorLayout:
                anchor_x: "center"
                anchor_y: "center"
                Label:
                    text: "Вопросы и ответы"
                    font_size: "20sp"
                    color: 0, 0, 0, 1
                    size_hint: None, None
                    size: self.texture_size

            # Right image (mail)
            AnchorLayout:
                anchor_x: "right"
                anchor_y: "center"
                size_hint_x: None
                width: dp(48)
                MDIconButton:
                    icon: "email"
                    size_hint: None, None
                    width: dp(48)
                    height: dp(48)
                    theme_color: "Custom"
                    color: 0, 0, 0, 1
                    on_release: app.open_mail_overlay()

        # Body (fills space between top bar and footer)
        BoxLayout:
            id: body_host
            orientation: "vertical"
            size_hint: None, None
            x: 0
            y: footer.height
            width: root.width
            height: root.height - top_bar.height - footer.height
            ScrollView:
                size_hint: 1, 1
                do_scroll_x: False
                do_scroll_y: True
                scroll_wheel_distance: dp(72)
                scroll_type: ['bars', 'content']
                bar_width: 0
                effect_cls: "ScrollEffect"
                MDBoxLayout:
                    orientation: "vertical"
                    spacing: dp(16)
                    padding: dp(12), dp(12), dp(12), dp(12)
                    size_hint_y: None
                    height: self.minimum_height
                    ScrollableTextLabel:
                        text: '1. Почему не начислили изумруды за покупку?В чеке есть скидка, поэтому изумруды не начислены, акции не суммируются.В заказе были списаны изумруды, поэтому остальные изумруды не начислены на остаток чека.Был куплен напиток объемом 600мл. На данный объем изумруды не начисляются, так как все напитки объемом 600 мл. участвуют в акции «10-ый напиток в подарок». За покупку ты получил штамп.Данная покупка не проведена через программу лояльности, в твоей истории покупок ее сейчас нет. В таком случае, тебе стоит написать нам на почту b2b@onepricecoffee.com приложив чек или сообщив купленные позиции и номер телефона, по которому ты зарегистрирован в нашей программе лояльности.2. Почему исчезли изумруды?Накопленные изумруды за покупки активны 90 дней, и они сгорят, если ты не совершил покупку по программе лояльности в течение 90 дней. В случае, если покупка была сделана, то изумруды продлеваются еще на 90 дней.3. Почему не начислили стакан по акции «10-ый напиток в подарок»?В акции участвуют только напитки объемом 600 мл.Данная покупка не проведена через программу лояльности, в твоей истории покупок ее сейчас нет. В таком случае, тебе стоит написать нам на почту b2b@onepricecoffee.com приложив чек или сообщив купленные позиции и номер телефона, по которому ты зарегистрирован в нашей программе лояльности.4. Почему я не могу списать изумруды?Можно списать только до 30% от стоимости блюда или напитка, если изумруды есть на счету.Изумрудов хватает для списания, но бариста не может их списать, то тогда рекомендуем написать нам на почту b2b@onepricecoffee.com, сообщив номер телефона, по которому ты зарегистрирован в нашей программе лояльности.Нельзя списать изумруды, если в заказе есть скидка.Нельзя списать изумруды на напиток объемом 600 мл.5. Почему я не могу забрать подарок по акции «10-ый напиток в подарок»?В подарок идут напитки объемом 600 мл.Не достаточно штампов накоплено для того, чтобы забрать подарок.Подарок есть, но бариста не может его выдать.6. Изменился или понизился статус (уровень). Почему?Статус динамический. Статусы 7% и 10% необходимо подтверждать, они зависят от суммы покупок, которую ты совершил в течение 90 дней с момента перехода.Статус 7% — мин. сумма от 5 000 р., статус 10% — мин. сумма от 7 000 р. Если данную сумму покупок ты не набрал за 90 дней, то происходит переход на пониженный уровень. Если в течение 90 дней у тебя совсем не было покупок, то статус становится 3%.Информацию о сумме покупок, которую необходимо совершить для получения статуса, указана в правилах программы лояльности.Если информация меняется не корректно или не меняется вовсе, то просим тебя написать нам на почту b2b@onepricecoffee.com, сообщив об ошибке и свой номер телефона, по которому ты зарегистрирован в нашей программе лояльности.7. ДругоеЕсли ты не нашел ответ на свой вопрос в правилах программы лояльности или в разделе "Частые вопросы", то напиши нам на почту b2b@onepricecoffee.com, описав проблему и сообщив номер телефона, по которому ты зарегистрирован в нашей программе лояльности.'

        # Footer
        BoxLayout:
            id: footer
            size_hint_x: 1
            size_hint_y: None
            height: dp(88)
            pos_hint: {"x": 0, "y": 0}
            padding: dp(12), dp(8)
            spacing: dp(12)
            canvas.before:
                Color:
                    rgba: 1, 1, 1, 1
                Rectangle:
                    source: "assets/backgrounds/Footer.jpg"
                    pos: self.pos
                    size: self.size
            FooterButton:
                on_release: app.footer_addresses_click()
                AnchorLayout:
                    anchor_x: "center"
                    anchor_y: "center"
                    MDIcon:
                        icon: "map-marker"
                        size_hint: None, None
                        width: dp(24)
                        height: dp(24)
                        theme_color: "Custom"
                        color: 0, 0, 0, 1
                AnchorLayout:
                    anchor_x: "center"
                    anchor_y: "center"
                    Label:
                        text: "Наши кофейни"
                        font_size: "12sp"
                        halign: "center"
                        valign: "middle"
                        text_size: self.size
                        color: 0, 0, 0, 1
            FooterLogoButton:
                on_release: app.open_loyalty_overlay()
                Image:
                    source: "assets/icons/Logo.jpg"
                    size_hint: None, None
                    width: dp(64)
                    height: dp(64)
                    allow_stretch: True
                    keep_ratio: True
            FooterButton:
                on_release: app.footer_invite_click()
                AnchorLayout:
                    anchor_x: "center"
                    anchor_y: "center"
                    MDIcon:
                        icon: "account-plus"
                        size_hint: None, None
                        width: dp(24)
                        height: dp(24)
                        theme_color: "Custom"
                        color: 0, 0, 0, 1
                AnchorLayout:
                    anchor_x: "center"
                    anchor_y: "center"
                    Label:
                        text: "Пригласить"
                        font_size: "12sp"
                        halign: "center"
                        valign: "middle"
                        text_size: self.size
                        color: 0, 0, 0, 1

        # Mail overlay (right drawer like menu)
        FloatLayout:
            id: mail_overlay_root
            size_hint: None, None
            size: 0, 0
            opacity: 0
            disabled: True
            canvas.before:
                Color:
                    rgba: 0, 0, 0, 0.5
                Rectangle:
                    pos: self.pos
                    size: self.size
            Button:
                background_color: 0,0,0,0
                size_hint: 1, 1
                disabled: self.parent.disabled
                on_release: app.close_mail_overlay()
            BoxLayout:
                id: mail_panel
                orientation: "vertical"
                size_hint_y: 1
                size_hint_x: None
                width: root.width * 0.8
                x: root.width
                y: 0
                padding: dp(16), dp(24)
                spacing: dp(16)
                canvas.before:
                    Color:
                        rgba: 1, 1, 1, 1
                    Rectangle:
                        pos: self.pos
                        size: self.size
                BoxLayout:
                    orientation: "horizontal"
                    size_hint_y: None
                    height: dp(40)
                    spacing: dp(8)
                    MDLabel:
                        text: "Входящие"
                        halign: "left"
                        valign: "middle"
                        text_size: self.size
                        color: 0,0,0,1
                    MDIconButton:
                        icon: "close"
                        theme_text_color: "Custom"
                        text_color: 0,0,0,1
                        on_release: app.close_mail_overlay()
                ScrollView:
                    size_hint_x: 1
                    size_hint_y: 1
                    do_scroll_x: False
                    do_scroll_y: True
                    scroll_wheel_distance: dp(72)
                    scroll_type: ['bars', 'content']
                    bar_width: 0
                    effect_cls: "ScrollEffect"
                    MDBoxLayout:
                        id: mail_list
                        orientation: "vertical"
                        spacing: dp(10)
                        size_hint_y: None
                        height: self.minimum_height

        LoyaltyOverlay:
            id: loyalty_overlay_root

